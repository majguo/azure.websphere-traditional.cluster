{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "basics": [
            {
                "name": "licenseInfo",
                "type": "Microsoft.Common.InfoBox",
                "options": {
                    "icon": "Info",
                    "text": "Accept the IBM License Agreement to proceed with the deployment. <a href='https://ibm.biz/tWASNDLicenseAzureVMs' target='_blank'>IBM WebSphere Application Server Network Deployment</a>."
                }
            },
            {
                "name": "acceptIBMLicenseAgreement",
                "type": "Microsoft.Common.CheckBox",
                "label": "I accept the IBM License Agreement.",
                "toolTip": "Select to accept the IBM License Agreement.",
                "constraints": {
                    "required": true,
                    "validationMessage": "The deployment will not proceed unless you accept the IBM License Agreement."
                }
            },
            {
                "name": "howToReportIssues",
                "type": "Microsoft.Common.Section",
                "label": "Report issues, get help, and share feedback",
                "elements": [
                    {
                        "name": "howToReportIssueText",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "If you encounter problems during deployment of WebSphere, open an issue.",
                            "link": {
                                "label": "Issue tracker",
                                "uri": "https://aka.ms/azure-twasnd-cluster-issues?version=${project.version}"
                            }
                        }
                    },
                    {
                        "name": "howToReportVendorIssueText",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "To use your existing IBM support contract, open an issue with IBM directly.",
                            "link": {
                                "label": "IBM support",
                                "uri": "https://www.ibm.com/mysupport/"
                            }
                        }
                    },
                    {
                        "name": "survey",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "To get free help with Azure migration from the development team, fill out this survey.",
                            "link": {
                                "label": "Take survey",
                                "uri": "https://aka.ms/ibm-stack-migration-survey"
                            }
                        }
                    }
                ],
                "visible": true
            }
        ],
        "steps": [
            {
                "name": "ClusterConfig",
                "label": "Cluster configuration",
                "subLabel": {
                    "preValidation": "Configure the resources and settings of the virtual machine that installs IBM WebSphere cluster.",
                    "postValidation": "Done"
                },
                "bladeTitle": "Cluster configuration",
                "elements": [
                    {
                        "name": "numberOfNodes",
                        "type": "Microsoft.Common.Slider",
                        "min": 2,
                        "max": 21,
                        "label": "Number of VMs",
                        "defaultValue": 4,
                        "showStepMarkers": false,
                        "toolTip": "The number of virtual machines to create, with one deployment manager and one to twenty worker nodes. More worker nodes usually need longer time to deploy.",
                        "constraints": {
                            "required": true
                        }
                    },
                    {
                        "name": "vmSizeSelect",
                        "type": "Microsoft.Compute.SizeSelector",
                        "label": "VM size",
                        "toolTip": "The size of virtual machine to provision.",
                        "recommendedSizes": [
                            "Standard_D2_v3",
                            "Standard_A4_v2",
                            "Standard_A2_v2",
                            "Standard_A1_v2",
                            "Standard_B2ms",
                            "Standard_B2s",
                            "Standard_B1ms"
                        ],
                        "constraints": {
                            "excludedSizes": [
                                "Standard_B1ls",
                                "Standard_A0",
                                "Basic_A0",
                                "Standard_B1s"
                            ]
                        },
                        "osPlatform": "Linux",
                        "count": "1"
                    },
                    {
                        "name": "dmgrVMPrefix",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Deployment manager server prefix",
                        "toolTip": "The string to prepend to the name of the deployment manager server, default is 'dmgr'.",
                        "defaultValue": "dmgr",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z]{3,14}$",
                            "validationMessage": "The prefix must be between 3 and 14 characters long and contain letters, numbers only."
                        }
                    },
                    {
                        "name": "managedVMPrefix",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Managed server prefix",
                        "toolTip": "The string to prepend to the name of the managed server, default is 'managed'.",
                        "defaultValue": "managed",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z]{3,14}$",
                            "validationMessage": "The prefix must be between 3 and 14 characters long and contain letters, numbers only."
                        }
                    },
                    {
                        "name": "dnsLabelPrefix",
                        "type": "Microsoft.Common.TextBox",
                        "label": "DNS label prefix",
                        "toolTip": "The string to prepend to the DNS label, default is 'wasndcluster'.",
                        "defaultValue": "wasndcluster",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z]{3,24}$",
                            "validationMessage": "The prefix must be between 3 and 24 characters long and contain letters, numbers only."
                        }
                    },
                    {
                        "name": "adminUsername",
                        "type": "Microsoft.Common.TextBox",
                        "label": "VM administrator",
                        "defaultValue": "websphere",
                        "toolTip": "Use only letters and numbers.",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z]{1,30}$",
                            "validationMessage": "The value must be 1-30 characters long and must only contain letters and numbers."
                        }
                    },
                    {
                        "name": "adminPasswordOrKey",
                        "type": "Microsoft.Compute.CredentialsCombo",
                        "label": {
                            "authenticationType": "Authentication type",
                            "password": "Password for VM administrator",
                            "confirmPassword": "Confirm password",
                            "sshPublicKey": "SSH Public Key for VM administrator"
                        },
                        "toolTip": {
                            "authenticationType": "Use user and password or SSH Public Key for authentication to the virtual machine."
                        },
                        "constraints": {
                            "required": true
                        },
                        "options": {
                            "hideConfirmation": false,
                            "hidePassword": false
                        },
                        "osPlatform": "Linux"
                    }
                ]
            },
            {
                "name": "IHSConfig",
                "label": "IBM HTTP Server Load Balancer",
                "subLabel": {
                    "preValidation": "Configure the IBM HTTP Server load balancer that routes client requests to IBM WebSphere cluster.",
                    "postValidation": "Done"
                },
                "bladeTitle": "IHS configuration",
                "elements": [
                    {
                        "name": "configIHS",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Configure an IBM HTTP Server?",
                        "defaultValue": "Yes",
                        "toolTip": "Select 'Yes' and provide the required information to configure an IBM HTTP Server. If you select 'No', you will not be able to use this offer to add IBM HTTP Server later to an existing cluster. You either must set up a new cluster or add IBM HTTP Server manually.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes",
                                    "value": "true"
                                },
                                {
                                    "label": "No",
                                    "value": "false"
                                }
                            ],
                            "required": true
                        }
                    },
                    {
                        "name": "ihsInfo",
                        "type": "Microsoft.Common.Section",
                        "label": "IBM HTTP Server settings",
                        "elements": [
                            {
                                "name": "ihsVmSize",
                                "type": "Microsoft.Compute.SizeSelector",
                                "label": "VM size",
                                "toolTip": "The size of virtual machine to provision.",
                                "recommendedSizes": [
                                    "Standard_D2_v3",
                                    "Standard_A4_v2",
                                    "Standard_A2_v2",
                                    "Standard_A1_v2",
                                    "Standard_B2ms",
                                    "Standard_B2s",
                                    "Standard_B1ms"
                                ],
                                "constraints": {
                                    "excludedSizes": [
                                        "Standard_B1ls",
                                        "Standard_A0",
                                        "Basic_A0",
                                        "Standard_B1s"
                                    ]
                                },
                                "osPlatform": "Linux",
                                "count": "1"
                            },
                            {
                                "name": "ihsVMPrefix",
                                "type": "Microsoft.Common.TextBox",
                                "label": "IBM HTTP Server prefix",
                                "toolTip": "The string to prepend to the name of the IBM HTTP Server, default is 'ihs'.",
                                "defaultValue": "ihs",
                                "constraints": {
                                    "required": true,
                                    "regex": "^[a-z0-9A-Z]{3,14}$",
                                    "validationMessage": "The prefix must be between 3 and 14 characters long and contain letters, numbers only."
                                }
                            },
                            {
                                "name": "ihsDnsLabelPrefix",
                                "type": "Microsoft.Common.TextBox",
                                "label": "DNS label prefix",
                                "toolTip": "The string to prepend to the DNS label, default is 'ihs'.",
                                "defaultValue": "ihs",
                                "constraints": {
                                    "required": true,
                                    "regex": "^[a-z0-9A-Z]{3,24}$",
                                    "validationMessage": "The prefix must be between 3 and 24 characters long and contain letters, numbers only."
                                }
                            },
                            {
                                "name": "ihsUnixUsername",
                                "type": "Microsoft.Common.TextBox",
                                "label": "VM administrator",
                                "defaultValue": "ihsadmin",
                                "toolTip": "Use only letters and numbers.",
                                "constraints": {
                                    "required": true,
                                    "regex": "^[a-z0-9A-Z]{1,30}$",
                                    "validationMessage": "The value must be 1-30 characters long and must only contain letters and numbers."
                                }
                            },
                            {
                                "name": "ihsUnixPasswordOrKey",
                                "type": "Microsoft.Compute.CredentialsCombo",
                                "label": {
                                    "authenticationType": "Authentication type",
                                    "password": "Password for VM administrator",
                                    "confirmPassword": "Confirm password",
                                    "sshPublicKey": "SSH Public Key for VM administrator"
                                },
                                "toolTip": {
                                    "authenticationType": "Use user and password or SSH Public Key for authentication to the virtual machine."
                                },
                                "constraints": {
                                    "required": true
                                },
                                "options": {
                                    "hideConfirmation": false,
                                    "hidePassword": false
                                },
                                "osPlatform": "Linux"
                            },
                            {
                                "name": "ihsAdminUsername",
                                "type": "Microsoft.Common.TextBox",
                                "label": "IBM HTTP Server administrator",
                                "defaultValue": "ihsadmin",
                                "toolTip": "Use only allowed characters.",
                                "constraints": {
                                    "required": true,
                                    "regex": "^[a-z0-9A-Z]{1,30}$",
                                    "validationMessage": "The value must be 1-30 characters long and must only contain letters and numbers."
                                }
                            },
                            {
                                "name": "ihsAdminPassword",
                                "type": "Microsoft.Common.PasswordBox",
                                "label": {
                                    "password": "Password for IBM HTTP Server administrator",
                                    "confirmPassword": "Confirm password"
                                },
                                "toolTip": "Password for IBM HTTP Server administrator.",
                                "constraints": {
                                    "required": true,
                                    "regex": "^(?=.*[A-Z])(?=.*[a-z])(?=.*\\d)[A-Za-z\\d]{12,}$",
                                    "validationMessage": "The password must contain at least 12 characters, with at least 1 uppercase letter, 1 lowercase letter and 1 number, and special characters are not allowed."
                                }
                            }
                        ],
                        "visible": "[bool(steps('IHSConfig').configIHS)]"
                    }
                ]
            }
        ],
        "outputs": {
            "location": "[location()]",
            "numberOfNodes": "[int(steps('ClusterConfig').numberOfNodes)]",
            "vmSize": "[steps('ClusterConfig').vmSizeSelect]",
            "dmgrVMPrefix": "[steps('ClusterConfig').dmgrVMPrefix]",
            "managedVMPrefix": "[steps('ClusterConfig').managedVMPrefix]",
            "dnsLabelPrefix": "[steps('ClusterConfig').dnsLabelPrefix]",
            "adminUsername": "[steps('ClusterConfig').adminUsername]",
            "adminPasswordOrKey": "[if(equals(steps('ClusterConfig').adminPasswordOrKey.authenticationType, 'password'), steps('ClusterConfig').adminPasswordOrKey.password, steps('ClusterConfig').adminPasswordOrKey.sshPublicKey)]",
            "authenticationType": "[steps('ClusterConfig').adminPasswordOrKey.authenticationType]",
            "configureIHS": "[bool(steps('IHSConfig').configIHS)]",
            "ihsVmSize": "[steps('IHSConfig').ihsInfo.ihsVmSize]",
            "ihsVMPrefix": "[steps('IHSConfig').ihsInfo.ihsVMPrefix]",
            "ihsDnsLabelPrefix": "[steps('IHSConfig').ihsInfo.ihsDnsLabelPrefix]",
            "ihsUnixUsername": "[steps('IHSConfig').ihsInfo.ihsUnixUsername]",
            "ihsUnixPasswordOrKey": "[if(equals(steps('IHSConfig').ihsInfo.ihsUnixPasswordOrKey.authenticationType, 'password'), steps('IHSConfig').ihsInfo.ihsUnixPasswordOrKey.password, steps('IHSConfig').ihsInfo.ihsUnixPasswordOrKey.sshPublicKey)]",
            "ihsAuthenticationType": "[steps('IHSConfig').ihsInfo.ihsUnixPasswordOrKey.authenticationType]",
            "ihsAdminUsername": "[steps('IHSConfig').ihsInfo.ihsAdminUsername]",
            "ihsAdminPassword": "[steps('IHSConfig').ihsInfo.ihsAdminPassword]"
        }
    }
}
